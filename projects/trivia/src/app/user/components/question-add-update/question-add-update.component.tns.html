<ns-action-bar [title]="isShowPreview ? 'Question Preview' : actionBarTxt" (isBackPress)="back($event)"
    [emitBackEvent]="editQuestion || isShowPreview ? true : false" class="SF-Pro-Regular" showAdd="true">
</ns-action-bar>
<GridLayout rows="*,auto" columns="*">
    <StackLayout>
        <StackLayout *ngIf="loaderBusy && !isShowPreview">
            <ActivityIndicator [busy]="loaderBusy" width="100" height="100" marginTop="225" class="activity-indicator">
            </ActivityIndicator>
        </StackLayout>
        <!-- <GridLayout [class.dialogOpen]="isShowPreview" [isUserInteractionEnabled]="isWebViewLoaded" rows="*" columns="*"
            *ngIf="!loaderBusy">
            <StackLayout>
                <NestedScrollView orientation="vertical">
                    <PreviousNextView row="0" col="0">
                        <GridLayout rows="*,auto,auto,auto,auto,auto" columns="*" (tap)="hideKeyboard()"
                            [formGroup]="questionForm" class="submit-question">
                            <StackLayout [class.margin-main-stack]="currentWebViewParentId === -1" #questionStack
                                row="0" class="question-section" iosOverflowSafeArea="false">
                                <FlexboxLayout class="edit-label" height="110" (tap)="showEditor('question')"
                                    justifyContent="center" alignItems="center"
                                    *ngIf="!questionForm.controls.isRichEditor.value && currentWebViewParentId != -1">
                                    <Label text="Click to add question" textWrap="true"></Label>
                                </FlexboxLayout>
                                <GridLayout minHeight="110" rows="*" columns="*" class="question-box"
                                    *ngIf="questionForm.controls.isRichEditor.value && currentWebViewParentId != -1"
                                    (tap)="showEditor('question')">
                                    <render-question *ngIf="questionForm.controls.questionObject" row="0" col="0"
                                        (tap)="showEditor('question')"
                                        [question]="{questionText: questionForm.controls.questionText.value, isRichEditor: true}">
                                    </render-question>
                                    <AbsoluteLayout (tap)="showEditor('question')" row="0" col="0"
                                        backgroundColor="transparent">
                                    </AbsoluteLayout>
                                </GridLayout>
                            </StackLayout>
                            <StackLayout row="1" class="answer-section" iosOverflowSafeArea="false">
                                <StackLayout formArrayName="answers">
                                    <StackLayout *ngFor="let answer of answers?.controls; let i=index"
                                        [formGroupName]="i">
                                        <GridLayout rows="*" columns="auto,*" class="text-box-section">
                                            <StackLayout row="0" col="0" (tap)="answerSelected(i)"
                                                class="checkbox checkbox-section">
                                                <CheckBox #elem formControlName="correct"
                                                    class="checkbox checkbox-section" fillColor="#71b02f"
                                                    (tap)="answerSelected(i)" (checkedChange)="checkedChanged($event)">
                                                </CheckBox>
                                            </StackLayout>

                                            <StackLayout [class.margin-main-stack]="currentWebViewParentId == i"
                                                #answerStack row="0" col="1">
                                                <FlexboxLayout height="110" class="edit-label" height="126"
                                                    (tap)="showEditor('answer', i)" justifyContent="center"
                                                    alignItems="center"
                                                    *ngIf="!answers.controls[i].controls.isRichEditor.value && currentWebViewParentId != i"
                                                    [class.question-box-solid]="false">
                                                    <Label text="Click to add option {{i+1}}"></Label>
                                                </FlexboxLayout>
                                                <GridLayout minHeight="110" rows="*" columns="*" class="question-box"
                                                    (tap)="showEditor('answer', i)"
                                                    *ngIf="answers.controls[i].controls.isRichEditor.value && currentWebViewParentId != i">
                                                    <render-answer [bgColor]="'#ffffff'" row="0" col="0"
                                                        [isRight]="false" (tapEvent)="showEditor('answer', i)"
                                                        [answer]="{answerText: answers.controls[i].controls.answerText.value, isRichEditor: true}">
                                                    </render-answer>
                                                    <AbsoluteLayout (tap)="showEditor('answer', i)" row="0" col="0"
                                                        backgroundColor="transparent">
                                                    </AbsoluteLayout>
                                                </GridLayout>
                                            </StackLayout>
                                        </GridLayout>
                                    </StackLayout>
                                </StackLayout>
                                <Label *ngIf="!answers.valid && !answers.pristine" class="error-lbl error"
                                    textWrap="true" text="All answers required !"></Label>
                            </StackLayout>
                             <StackLayout row="2" class="max-time-input" iosOverflowSafeArea="false">
                                <GridLayout rows="*" columns="*">
                                    <DropDown #timeDropdown itemsTextAlignment="center" row="0" [items]="playMaxTime"
                                        selectedIndex="{{selectedMaxTimeIndex}}"
                                        (selectedIndexChanged)="onchange($event)"></DropDown>
                                    <Image (tap)="openTimeDropdown()" row="0" src="~/assets/images/dropdown_char.png"
                                        class="tick-icon"></Image>
                                </GridLayout>
                            </StackLayout> 
                            <StackLayout row="3" class="category-input" iosOverflowSafeArea="false">
                                <GridLayout rows="*,*" columns="*">
                                    <GridLayout row="0" rows="*" columns="*">
                                        <DropDown #categoryDropdown itemsTextAlignment="center" row="0"
                                            [items]="questionCategories"
                                            selectedIndex="{{selectedQuestionCategoryIndex}}"
                                            (selectedIndexChanged)="selectCategory($event)"></DropDown>
                                        <Image (tap)="openCategoryDropdown()" row="0"
                                            src="~/assets/images/dropdown_char.png" class="tick-icon"></Image>
                                    </GridLayout>
                                </GridLayout>
                            </StackLayout>
                            <StackLayout iosOverflowSafeArea="false"
                                *ngIf="questionForm.valid  && (!categoryIds || (categoryIds && categoryIds.length===0))">
                                <Label color="red" text="Select a category !" textWrap="true" class="error-lbl"></Label>
                            </StackLayout>
                            <StackLayout row="4" iosOverflowSafeArea="false">
                                <StackLayout *ngIf="enteredTags.length>0" marginBottom="5">
                                    <FlexboxLayout *ngIf="enteredTags" flexWrap="wrap">
                                        <StackLayout *ngFor="let tags of let tag of enteredTags, let i = index">
                                            <FlexboxLayout alignItems="center"
                                                [style.backgroundColor]="theme === 'dark' ? '#405177':'#e2e2e2'"
                                                [style.color]="theme === 'dark' ? '#a5a5a5' : '#808080'"
                                                borderRadius="22" margin="2.5 2.5" padding="5 10">
                                                <Label [text]="tags" textWrap="true"></Label>
                                                <Label color="#000000" text="&#xe922;" fontSize="10"
                                                    class="ico icon-close" padding="7 5 7 7"
                                                    (tap)="removeEnteredTag(tag)"></Label>
                                            </FlexboxLayout>
                                        </StackLayout>
                                    </FlexboxLayout>
                                </StackLayout>
                                <GridLayout rows="auto,auto" columns="*,85" paddingBottom="20"
                                    class="two-player-option">
                                    <StackLayout row="0" col="0" tkExampleTitle tkToggleNavButton
                                        ios:backgroundColor="#ffffff">
                                        <RadAutoCompleteTextView borderWidth="1" borderColor="#a5a5a5" color="black"
                                            #autocomplete hint="Select Tag" [items]="dataItems"
                                            completionMode="Contains" showCloseButton="true"
                                            (didAutoComplete)="onDidAutoComplete($event)"
                                            (textChanged)="onTextChanged($event)" borderRadius="3" height="50"
                                            paddingLeft="10" ios:backgroundColor="#ffffff">
                                            <SuggestionView tkAutoCompleteSuggestionView>
                                                <ng-template tkSuggestionItemTemplate let-item="item">
                                                    <StackLayout orientation="vertical" padding="20">
                                                        <Label [text]="item.text"></Label>
                                                    </StackLayout>
                                                </ng-template>
                                            </SuggestionView>
                                        </RadAutoCompleteTextView>
                                    </StackLayout>
                                    <Button row="0" col="1" (rippleTap)="addCustomTag()" stlBackgroundColor="white"
                                        text="Add" class="SF-Pro-Bold add-btn" android:padding="5" fontSize="16"
                                        android:fontSize="10" ios:padding="10" stlRippleEffect></Button>
                                </GridLayout>
                            </StackLayout>
                            <GridLayout row="5" rows="*" columns="*,50,*" iosOverflowSafeArea="false"
                                class="button-section">
                                <Button stlRippleEffect row="0" col="0" colspan="2" [disabled]="!questionForm.valid"
                                    width="100%" [text]="submitBtnTxt" (rippleTap)="submit()"
                                    [ngClass]="(questionForm.valid && categoryIds && categoryIds.length > 0 && enteredTags.length > 2) ? 'enable-btn' : 'disable-btn' "
                                    class="question-buttons"></Button>
                                <FlexboxLayout stlRippleEffect borderRadius="3" class="enable-btn-preview"
                                    (rippleTap)="preview()" row="0" col="2" orientation="horizontal"
                                    justifyContent="center" padding="12">
                                    <Label text="Preview" textWrap="true"></Label>
                                </FlexboxLayout>
                            </GridLayout>
                        </GridLayout>
                    </PreviousNextView>
                </NestedScrollView>

            </StackLayout>
            <StackLayout *ngIf="!isWebViewLoaded">
                <AbsoluteLayout (tap)="preventEventPropogation()" row="0" col="0">
                    <StackLayout width="100%" verticalAlignment="center" height="100%">
                        <ActivityIndicator marginLeft="10" ios:width="500" ios:height="500" android:width="50"
                            android:height="50" busy="true">
                        </ActivityIndicator>
                    </StackLayout>
                </AbsoluteLayout>
            </StackLayout>
            <StackLayout height="0" #webViewParentStack>
                            <WebView height="215" width="100%" #webView id="questionWebView" (loaded)="webViewLoaded($event)">   </WebView>                  
                 
            </StackLayout>

            <StackLayout height="100%" class="dialog__wrapper">
                <app-preview-question-dialog [question]="previewQuestion" [categoryDictionary]="categories">
                </app-preview-question-dialog>
            </StackLayout>
        </GridLayout> -->



        <GridLayout [class.dialogOpen]="isShowPreview" rows="*,auto" columns="*" class="submit-question">
            <WebView row="0" col="0" width="100%" height="auto" #webView id="questionWebView"
                (loaded)="webViewLoaded($event)" (loadFinished)="weViewLoadFinished($event)"></WebView>
            <GridLayout row="1" col="0" columns="*,50,*" iosOverflowSafeArea="false" class="button-section">
                <Button stlRippleEffect row="0" col="0" colspan="2" width="100%" [text]="submitBtnTxt"
          
                    [ngClass]="{'enable-btn' : isFormValid, 'disable-btn' : !isFormValid }" class="question-buttons"
                    (tap)="getQuestion()"></Button>
                <FlexboxLayout stlRippleEffect borderRadius="3" class="enable-btn-preview" row="0" col="2"
                    orientation="horizontal" justifyContent="center" padding="12" (tap)="preview()">
                    <Label text="Preview" textWrap="true"></Label>
                </FlexboxLayout>
            </GridLayout>
            <StackLayout height="100%" class="dialog__wrapper">
                <app-preview-question-dialog [question]="previewQuestion" [categoryDictionary]="categories">
                </app-preview-question-dialog>
            </StackLayout>
        </GridLayout>

    </StackLayout>
    <Absolutelayout *ngIf="platform.isIOS" row="1" verticalAlignment="bottom">
        <bottom-bar [screen]="'profile-settings'" *ngIf="displayBottomBar">
        </bottom-bar>
    </Absolutelayout>

</GridLayout>